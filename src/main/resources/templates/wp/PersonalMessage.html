<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>个人信息</title>
    <link rel="stylesheet" href="/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/wpFoot.css">
    <script type="text/javascript" src="/js/jquery-3.3.1.min.js"></script>
    <script src="/dist/js/bootstrap.min.js"></script>
    <style>
        .item_content {
            /*padding-left: 100px;*/
            /*float: right;*/
            margin-bottom: 10px;
        }

        .item_content h3 {
            font-size: 14px;
            color: #FF6347;
            margin: 0;
        }

        .item_info {
            font-size: 12px;
            font-style: italic;
            margin: 15px;
            color: #999;
            display: none;
        }

        .item_desc {
            font-size: 14px;
            margin: 0;
            color: gray;
            margin-top: 50px; /*与h2有一定的边距*/
            border-left: solid 1px #ccc; /*设置左边框*/
            padding-left: 10px; /*设置左填充*/
        }

        .item_img {
            float: left;
            height: 120px;
            width: 120px;
        }

        .main-p {
            width: 60%;
            margin: 10px auto;
            padding: 4%;
            border: 2px solid gainsboro;
            background: white;
        }

        .left-p {
            float: right;
        }

        body {
            padding: 0px;
            margin: 0px;
        }

        .containers {
            width: 100%;
            height: 1400px;

        }

        .navbar-brand {
            padding: 0px;
            height: 60px;
            line-height: 60px;
            padding-left: 70px;
        }

        .navbar-brand img {
            display: block;
        }

        .navbar.navbar-light.bg-light {
            border: none;
            height: 60px;
            background-color: white !important;
            margin: 0px !important;
            padding: 0px !important;
            display: block;
        }

        .top {
            height: 61px;
            width: 100%;
            border-bottom: 1px solid #E4E4E4;

        }

        .ntop {
            height: 30px;
            width: 100%;
            font-size: 14px;
            line-height: 30px;
            color: #31708f;
        }

        .ct {
            float: left;
        }

        .logo {
            width: 15%;

        }

        .x {
            width: 80%;

            text-align: left;
            font-size: 24px;
            color: midnightblue;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        .nava a {
            padding: 0px !important;
            margin-right: 80px;
            color: midnightblue !important;

            font-size: 14px;
        }

        .carousel-item img {
            width: 100%;
            height: 412px;

        }

        .btn-loc {
            margin-top: 30px;

        }

        .ct {
            float: left;
        }

        .per-left {
            margin-right: 70px;
            margin-top: 10px;
            margin-left: 20px;
        }

        .text-gray {
            color: gray;
        }

        .btn-rf {
            float: right;
            margin-right: 10px;
        }

        .per-main {
            width: 100%;
            height: 1400px;
        }
    </style>
</head>
<body>
<div class="top">
    <nav class="navbar navbar-light bg-light">
        <div class="logo ct">
            <a class="navbar-brand" href="#">
                <img alt="Brand" src="/img/logo5.png" width="120px" height="60px">
            </a>
        </div>
        <div class="x ct">
            <ul class="nav nav-pills">

                <li role="presentation" class="nava"><a href="/wp/HomePage">首页</a></li>
                <li role="presentation" class="nava"><a href="#">咨询中心</a></li>
                <li role="presentation" class="nava"><a href="#">考试大纲</a></li>
                <li role="presentation" class="nava"><a href="#">考试咨询</a></li>
                <li role="presentation" class="nava"><a href="#">相关下载</a></li>
                <li role="presentation" class="nava"><a href="#">考生服务</a></li>
                <li role="presentation" class="nava"><a href="#">常见问题</a></li>
            </ul>
        </div>
    </nav>
</div>
<div class="ntop">
    <a>首页</a> ><a>个人信息</a>
</div>
<div class="per-main">
    <div class="per-left ct">
        <div class="card" style="width: 18rem;">
            <img class="card-img-top" src="/img/homepage5.jpg" alt="Card image cap">
            <div class="card-body">
                <h5 class="card-title">个人设置中心</h5>
                <p class="text-gray">你可以在这里设置您的基本账户信息、和学籍信息但是请您在设置学籍信息时慎重操作</p>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item" id="accountInfo">账户信息</li>
                <li class="list-group-item" id="studyInfo">学籍信息</li>
                <li class="list-group-item text-primary" id="rPwd" data-toggle="modal"
                    data-target="#exampleModalCenter">重置密码
                </li>
            </ul>
            <div class="card-body">
                <a href="/wp/HomePage" class="card-link">首页</a>
                <a href="#" class="card-link"  onClick=" window.location.href=document.referrer;">返回</a>
            </div>
        </div>
    </div>
    <div class="main-p ct">
        <h2 style="text-align: center;margin-bottom: 20px" class="account">账户信息</h2>
        <hr>
        <form>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputNickname">昵称</label>
                    <input type="text" class="form-control" id="inputNickname" th:value="${candidate.cNickname}">
                </div>

            </div>
            <div class="form-row ">


            </div>
            <div class="form-group">
                <label for="inputPhone">手机号</label>
                <input type="text" class="form-control" id="inputPhone" placeholder="手机号"
                       th:value="${candidate.cTelephone}">

            </div>
            <div class="form-group">
                <label for="inputEmail">邮箱</label>
                <input type="email" class="form-control" id="inputEmail" placeholder="Email"
                       th:value="${candidate.cMail}">
            </div>



            <small class="text-info">因为一些特殊原因以上数据暂不能修改</small>
            <div class="left-p form-group">
              <!--  <button type="submit" class="btn btn-primary ">修改</button>
                <button type="submit" class="btn btn-secondary">返回</button>-->

            </div>
        </form>
        <h2 style="text-align: center;margin-bottom: 20px;margin-top: 80px" class="study">学籍信息</h2>
        <hr>
        <div class="item_img">
            <img th:src="${candidate.cImage}" height="120px" width="100px" class="img">
        </div>
        <div class="item_content">
            <h2>证件照</h2>

            <from id="form-add" enctype="multipart/form-data">
                <input type="file" class="item_info " name="file" id="switchImg"/>
                <div class="btn-loc">
                    <button class="btn btn-primary btn-sm" id="browse">浏览</button>
                    <button class="btn btn-success btn-sm" type="button" onclick="submitFunction()">修改</button>
                    <small class="text-info" id="msg" style="display: none"></small>
                </div>
            </from>
            <p class="item_desc">.仅支持jpg、jpeg、png格式的文件<br></p>
            </p>
        </div>
        <hr>

        <form id="studyInfos">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputRelName">真实姓名</label>
                    <input type="text" class="form-control" id="inputRelName" name="cName" placeholder="真实姓名"
                           th:value="${candidate.cName}">
                </div>


            </div>


            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputCardNum">证件号</label>
                    <input type="text" class="form-control" id="inputCardNum" name="cIdcard" placeholder="证件号"
                           th:value="${candidate.cIdcard}">
                    <small class="text-danger warnCard" style="display: none" ></small>
                </div>
                <div class="form-group xun col-md-6">
                    <label> <!--for="exampleInputPassword1">-->证件类型：<span th:text="${candidate.cType}"
                                                                          class="text-info">12213</span></label>
                    <select id="typeOfIdCard" class="form-control form-select" name="cType">
                        <option value="0">请选择证件类型</option>
                        <option value="1">中华人民共和国居民身份证</option>
                        <option value="2">台湾居民往来大陆通行证</option>
                        <option value="3">港澳居民来往内地通行证</option>
                        <option value="4">军人证件</option>
                        <option value="5">护照</option>
                        <option value="6">香港身份证</option>
                        <option value="7">澳门身份证</option>
                    </select>

                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputScholl">所在学校</label>
                    <input type="text" class="form-control" readonly id="inputScholl" name="cSchool" placeholder="所在学校"
                           th:value="${candidate.cSchool}">
                    <small class="text-danger">*所在学校暂时不能修改</small>
                </div>
                <div class="form-group col-md-4">
                    <label for="inputCollege">院系</label>
                    <input type="text" class="form-control" id="inputCollege" name="cCollege" placeholder="院系"
                           th:value="${candidate.cCollege}">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputMajor">专业</label>
                    <input type="text" class="form-control" id="inputMajor" name="cMajor" placeholder="专业"
                           th:value="${candidate.cMajor}">
                </div>
                <div class="form-group col-md-4">
                    <label for="inputGrade">年级</label>
                    <input type="text" class="form-control" id="inputGrade" name="cGrade" placeholder="年级"
                           th:value="${candidate.cGrade}">
                </div>
                <div class="form-group col-md-2">
                    <label for="inputClass">班级</label>
                    <input type="text" class="form-control" id="inputClass" name="cClass" placeholder="班级"
                           th:value="${candidate.cClass}">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="inputStudyNum">学号</label>
                    <input type="text" class="form-control" id="inputStudyNum" name="cStuentNum" placeholder="学号"
                           th:value="${candidate.cStuentNum}">
                </div>
                <div class="form-group xun col-md-2">
                    <label> <!--for="exampleInputPassword1">-->性别</label>
                    <select id="typeOfID" class="form-control form-select" name="cSex"
                            th:if="${#strings.isEmpty(candidate.cSex)==false}">

                        <option th:value="${candidate.cSex}" th:text="${candidate.cSex}"></option>
                        <option th:value="${candidate.cSex}=='男'?'女':'男'" th:text="${candidate.cSex}=='男'?'女':'男'"></option>

                    </select>
                    <select id="typeOfID" class="form-control form-select" name="cSex"
                            th:if="${#strings.isEmpty(candidate.cSex)==true}">

                        <option value="男">男</option>
                        <option value="女">女</option>

                    </select>
                </div>
            </div>


            <div class="left-p">
                <button type="button" class="btn btn-primary " onclick="alterStudyInfo()">修改</button>
                <button type="button" class="btn btn-secondary" id="goTop">返回顶部</button>
            </div>
        </form>


    </div>
</div>


<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle">密码修改</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form>
                <div class="modal-body">


                    <div class="form-group"  style="height: 80px">
                        <label for="oldPwd">旧密码</label>
                        <input type="password" class="form-control" id="oldPwd" placeholder="old Password">
                        <small class="text-danger oldPwd" style="display: none"></small>
                    </div>
                    <div class="form-group" style="height: 80px">
                        <label for="newPwd">新密码
                            <small class="text-info">密码长度为8-16位字符，且必须同时包含：字母、数字</small>
                        </label>
                        <input type="password" class="form-control" id="newPwd" placeholder="new Password"
                               onchange="alterPwd(this.value)">
                        <small class="text-danger alterPwd1" style="display: none"></small>
                    </div>
                    <div class="form-group" style="height: 80px">
                        <label for="confirmPwd">确认新密码</label>
                        <input type="password" class="form-control" id="confirmPwd" placeholder="confirm Password"
                               onchange="alterPwd2(this.value)">
                        <small class="text-danger alterPwd2" style="display: none"></small>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="submit1()">提交</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="foot">
    <!-- <div class="bottom_left"><img src="../img/logo.jpg"> </div>-->
    <div class="links">
        <a href="#">
            关于考拉
        </a>
        |
        <a href="#">
            联系我们
        </a>
        |
        <a href="#">
            人才招聘
        </a>
        |
        <a href="#">
            广告服务
        </a>
        |
        <a href="#">
            微信考拉
        </a>
        |
        <a href="#">
            侵权投诉
        </a>
    </div>

    <div class="copyright">
        Copyright&nbsp;&copy;&nbsp;2004-2019&nbsp;&nbsp;考拉KL.com&nbsp;版权所有
    </div>
</div>
<script th:inline="javascript">
    $("#browse").click(function () {
        $("#switchImg").click()
    })
    $("#switchImg").change(function () {
        var file = $(this).prop("files")[0]
        if (file) {
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onloadend = function (even) {
                $('.img').attr("src", even.currentTarget.result);
            }
        }

    })
    $(function () {
        $("#accountInfo").click(function () {
            $('html , body').animate({scrollTop: $('.account').offset().top}, 300);
        })
        $("#studyInfo").click(function () {
            $('html , body').animate({scrollTop: $('.study').offset().top}, 300);
        })
        $("#goTop").click(function () {
            $('html , body').animate({scrollTop: top}, 300);
        })


    })

    function submitFunction() {
        //这里唯一需要注意的就是这个form-add的id
        // var formData = new FormData($("#form-add")[0]);
        var keys = [[${candidate.cId}]]
        var formData = new FormData();
        formData.append("file", $("#switchImg")[0].files[0]);
        formData.append("keys", keys)
        $.ajax({
            //接口地址
            url: 'PersonUpLoad',
            type: 'POST',
            data: formData,

            cache: false,
            contentType: false,
            dataType: 'json',
            processData: false,
            success: function (data) {
                console.log(data.msg)
                $("#msg").text(data.msg).show().delay(3000).hide(0)


            },
            error: function (returndata) {
                //请求异常的回调
                // modals.warn("网络访问失败，请稍后重试!");
            }
        })
    }

    function alterStudyInfo() {
        var keys = [[${candidate.cId}]]
        $.ajax({
            //几个参数需要注意一下
            type: "POST",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "PersonAlter",//url
            data: $('#studyInfos').serialize(),
            success: function (result) {
                //console.log(result);//打印服务端返回的数据(调试用)
                if(result==204){
                    $(".warnCard").text("此身份证号已注册，请检查").show().delay(3000).hide(0)
                }
                if(result==200) {
                 // window.location.reload()

                }
            },
            error: function () {
                alert("异常！");
            }
        });

    }

    var flag1 = false, flag2 = false;

    function alterPwd(e) {

        if (!e.match(/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/)) {

            $(".alterPwd1").text("密码格式不正确").show()
            flag1 = false
        } else {
            $(".alterPwd1").hide()
            flag1 = true
        }
    }

    function alterPwd2(e) {
        var newpwd = $("#newPwd").val()
        if (e != newpwd) {

            $(".alterPwd2").text("密码不一致").show()
            flag2 = false
        } else {
            $(".alterPwd2").hide()
            flag2 = true
        }
    }

    function submit1() {
        var oldPwd=$("#oldPwd").val()
        if(flag1==true&&flag2==true&&oldPwd!=null){
            var newPwd=$("#newPwd").val()
            if(oldPwd!=newPwd) {
                $.ajax({
                    url: "PersonAlterPwd",
                    async: false,
                    type: 'post',
                    dataType: 'json',
                    data: {"oldPwd": oldPwd, "newPwd": newPwd},
                    success: function (data) {
                        if (data == 200) {
                            $(".oldPwd").text("密码更新成功").show()
                        } else {
                            $(".oldPwd").text("旧密码错误").show().delay(3000).hide(0)
                        }
                    },
                    error: function (e) {
                        alert(e)
                    }
                })
            }else {
                $(".oldPwd").text("新旧密码不能一样").show().delay(3000).hide(0)
            }
        }

    }

</script>
</body>
</html>